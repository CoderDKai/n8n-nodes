# 企业微信群机器人节点 - 快速开始指南

本指南将帮助您在5分钟内完成企业微信群机器人节点的配置和使用。

## 🚀 快速配置

### 步骤1：获取企业微信群机器人Webhook URL

1. 打开企业微信，进入目标群聊
2. 点击群聊右上角的"..."菜单
3. 选择"群机器人"
4. 点击"添加机器人"
5. 选择"自定义机器人"
6. 设置机器人名称和头像
7. 复制生成的Webhook URL

### 步骤2：在n8n中创建凭据

1. 在n8n界面中，点击左侧菜单的"凭据"
2. 点击右上角的"新建凭据"
3. 在搜索框中输入"企业微信"
4. 选择"企业微信群机器人API"
5. 将步骤1中复制的Webhook URL粘贴到"Webhook URL"字段
6. 点击"测试连接"按钮验证配置
7. 输入凭据名称（如"我的群机器人"）
8. 点击"保存"

### 步骤3：创建第一个工作流

1. 在n8n中创建新的工作流
2. 添加"手动触发器"节点
3. 添加"企业微信群机器人"节点
4. 连接两个节点

### 步骤4：配置消息节点

1. 选择企业微信群机器人节点
2. 在"凭据"下拉框中选择步骤2创建的凭据
3. 设置以下参数：
   - **消息类型**: 选择"文本消息"
   - **消息内容**: 输入"Hello, 这是我的第一条消息！"
   - **@提及用户**: 输入"@all"（可选）

### 步骤5：测试发送

1. 点击工作流右上角的"执行工作流"按钮
2. 点击"手动触发器"节点的"执行节点"按钮
3. 检查企业微信群聊，应该能看到机器人发送的消息

## 🎯 常用场景示例

### 场景1：发送简单文本通知

```json
{
  "messageType": "text",
  "content": "系统维护完成，服务已恢复正常。",
  "mentionedUsers": "@all"
}
```

### 场景2：发送格式化报告

```json
{
  "messageType": "markdown",
  "markdownContent": "# 📊 系统状态报告\n\n**时间**: 2024-01-15 10:30\n**状态**: ✅ 正常\n**CPU使用率**: 45%\n**内存使用率**: 62%\n\n---\n\n所有服务运行正常"
}
```

### 场景3：发送图文卡片

```json
{
  "messageType": "news",
  "articles": [
    {
      "title": "新功能发布通知",
      "description": "我们刚刚发布了新的用户界面，快来体验吧！",
      "url": "https://example.com/new-features",
      "picurl": "https://example.com/images/new-ui.jpg"
    }
  ]
}
```

## 🔧 进阶配置

### 动态内容

使用n8n表达式语法创建动态消息：

```json
{
  "messageType": "text",
  "content": "处理完成！共处理了 {{$json.count}} 条记录，耗时 {{$json.duration}} 秒。"
}
```

### 条件发送

结合IF节点实现条件发送：

```json
{
  "condition": "{{$json.status}} === 'error'",
  "trueMessage": {
    "messageType": "text",
    "content": "⚠️ 发现错误：{{$json.errorMessage}}",
    "mentionedUsers": "admin1,admin2"
  },
  "falseMessage": {
    "messageType": "text",
    "content": "✅ 处理成功完成"
  }
}
```

### 批量发送

处理多个输入项，每个项目发送一条消息：

```javascript
// 在Function节点中准备数据
const users = [
  { name: "张三", task: "完成报告" },
  { name: "李四", task: "审核文档" },
  { name: "王五", task: "测试功能" }
];

return users.map(user => ({
  json: {
    content: `Hi ${user.name}，请记得${user.task}。`
  }
}));
```

## 🛠️ 故障排除

### 问题1：消息发送失败

**错误信息**: "消息发送失败: Webhook URL无效或已过期"

**解决方案**:
1. 检查Webhook URL是否正确复制
2. 确认群机器人没有被删除
3. 重新生成Webhook URL并更新凭据

### 问题2：@提及不工作

**错误信息**: @提及的用户没有收到通知

**解决方案**:
1. 确认用户在目标群聊中
2. 使用正确的用户ID或手机号
3. 尝试使用"@all"提及所有人

### 问题3：图片发送失败

**错误信息**: "图片格式不支持"

**解决方案**:
1. 确保图片格式为JPG或PNG
2. 检查图片大小不超过2MB
3. 验证Base64编码是否正确

## 📚 更多资源

- [完整文档](./README.md) - 详细的功能说明和API参考
- [工作流示例](./examples/workflow-examples.json) - 更多实用的工作流模板
- [企业微信机器人API文档](https://developer.work.weixin.qq.com/document/path/91770) - 官方API文档

## 💡 小贴士

1. **测试先行**: 在生产环境使用前，先在测试群中验证配置
2. **频率控制**: 避免过于频繁的消息发送，以免被限流
3. **内容优化**: 保持消息简洁明了，突出重要信息
4. **错误处理**: 启用"出错时继续"选项，确保工作流稳定运行
5. **日志监控**: 定期检查执行日志，及时发现和解决问题

## 🎉 恭喜！

您已经成功配置了企业微信群机器人节点！现在可以开始构建更复杂的自动化工作流了。

如果您需要更多帮助，请查看完整文档或联系技术支持。