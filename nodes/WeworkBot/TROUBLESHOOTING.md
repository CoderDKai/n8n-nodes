# ä¼ä¸šå¾®ä¿¡ç¾¤æœºå™¨äººèŠ‚ç‚¹ - æ•…éšœæ’é™¤æŒ‡å—

æœ¬æŒ‡å—æä¾›äº†å¸¸è§é—®é¢˜çš„è§£å†³æ–¹æ¡ˆå’Œè°ƒè¯•æŠ€å·§ï¼Œå¸®åŠ©æ‚¨å¿«é€Ÿè§£å†³ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ã€‚

## ğŸš¨ å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

### 1. è¿æ¥å’Œè®¤è¯é”™è¯¯

#### é”™è¯¯ä»£ç : 93000
**é”™è¯¯ä¿¡æ¯**: "Webhook URLæ— æ•ˆæˆ–å·²è¿‡æœŸ"

**å¯èƒ½åŸå› **:
- Webhook URLæ ¼å¼ä¸æ­£ç¡®
- ç¾¤æœºå™¨äººå·²è¢«åˆ é™¤æˆ–ç¦ç”¨
- URLä¸­çš„keyå‚æ•°å·²è¿‡æœŸ

**è§£å†³æ­¥éª¤**:
1. æ£€æŸ¥Webhook URLæ ¼å¼æ˜¯å¦æ­£ç¡®ï¼š
   ```
   https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=YOUR_KEY
   ```
2. åœ¨ä¼ä¸šå¾®ä¿¡ç¾¤ä¸­ç¡®è®¤æœºå™¨äººä»ç„¶å­˜åœ¨
3. é‡æ–°ç”ŸæˆWebhook URLï¼š
   - è¿›å…¥ç¾¤èŠ â†’ ç¾¤æœºå™¨äºº â†’ é€‰æ‹©å¯¹åº”æœºå™¨äºº â†’ é‡æ–°ç”ŸæˆURL
4. æ›´æ–°n8nä¸­çš„å‡­æ®é…ç½®

#### é”™è¯¯ä»£ç : -1
**é”™è¯¯ä¿¡æ¯**: "ç½‘ç»œè¿æ¥å¤±è´¥"

**å¯èƒ½åŸå› **:
- ç½‘ç»œè¿æ¥é—®é¢˜
- é˜²ç«å¢™é˜»æ­¢è®¿é—®
- DNSè§£æå¤±è´¥

**è§£å†³æ­¥éª¤**:
1. æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
2. æµ‹è¯•æ˜¯å¦èƒ½è®¿é—®ä¼ä¸šå¾®ä¿¡APIï¼š
   ```bash
   curl -I https://qyapi.weixin.qq.com
   ```
3. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®ï¼Œç¡®ä¿å…è®¸è®¿é—®ä¼ä¸šå¾®ä¿¡åŸŸå
4. å¦‚æœä½¿ç”¨ä»£ç†ï¼Œç¡®è®¤ä»£ç†é…ç½®æ­£ç¡®

### 2. æ¶ˆæ¯æ ¼å¼é”™è¯¯

#### é”™è¯¯ä»£ç : 40001
**é”™è¯¯ä¿¡æ¯**: "å‚æ•°é”™è¯¯"

**å¯èƒ½åŸå› **:
- æ¶ˆæ¯å†…å®¹ä¸ºç©º
- æ¶ˆæ¯æ ¼å¼ä¸ç¬¦åˆè¦æ±‚
- å‚æ•°ç±»å‹é”™è¯¯

**è§£å†³æ­¥éª¤**:
1. æ£€æŸ¥å¿…å¡«å­—æ®µæ˜¯å¦å·²å¡«å†™
2. éªŒè¯æ¶ˆæ¯å†…å®¹é•¿åº¦é™åˆ¶ï¼š
   - æ–‡æœ¬æ¶ˆæ¯ï¼šæœ€å¤§4096å­—ç¬¦
   - Markdownæ¶ˆæ¯ï¼šæœ€å¤§4096å­—ç¬¦
   - å›¾æ–‡æ¶ˆæ¯æ ‡é¢˜ï¼šæœ€å¤§128å­—ç¬¦
   - å›¾æ–‡æ¶ˆæ¯æè¿°ï¼šæœ€å¤§512å­—ç¬¦
3. ç¡®è®¤å‚æ•°ç±»å‹æ­£ç¡®

#### é”™è¯¯ä¿¡æ¯: "æ¶ˆæ¯éªŒè¯å¤±è´¥"

**å¸¸è§éªŒè¯é”™è¯¯**:

**æ–‡æœ¬æ¶ˆæ¯**:
```javascript
// âŒ é”™è¯¯ï¼šå†…å®¹ä¸ºç©º
{
  "messageType": "text",
  "content": ""
}

// âœ… æ­£ç¡®
{
  "messageType": "text",
  "content": "è¿™æ˜¯ä¸€æ¡æœ‰æ•ˆçš„æ–‡æœ¬æ¶ˆæ¯"
}
```

**Markdownæ¶ˆæ¯**:
```javascript
// âŒ é”™è¯¯ï¼šå†…å®¹ä¸ºç©º
{
  "messageType": "markdown",
  "markdownContent": ""
}

// âœ… æ­£ç¡®
{
  "messageType": "markdown",
  "markdownContent": "# æ ‡é¢˜\n\nè¿™æ˜¯**ç²—ä½“**æ–‡æœ¬"
}
```

**å›¾ç‰‡æ¶ˆæ¯**:
```javascript
// âŒ é”™è¯¯ï¼šBase64æ•°æ®æ— æ•ˆ
{
  "messageType": "image",
  "imageSource": "base64",
  "imageBase64": "invalid-base64-data"
}

// âœ… æ­£ç¡®
{
  "messageType": "image",
  "imageSource": "base64",
  "imageBase64": "iVBORw0KGgoAAAANSUhEUgAA..."
}
```

### 3. å›¾ç‰‡ç›¸å…³é”™è¯¯

#### é”™è¯¯ä¿¡æ¯: "å›¾ç‰‡æ ¼å¼ä¸æ”¯æŒ"

**è§£å†³æ­¥éª¤**:
1. ç¡®è®¤å›¾ç‰‡æ ¼å¼ä¸ºJPGæˆ–PNG
2. æ£€æŸ¥æ–‡ä»¶æ‰©å±•åæ˜¯å¦æ­£ç¡®
3. éªŒè¯å›¾ç‰‡æ–‡ä»¶æ˜¯å¦æŸå

#### é”™è¯¯ä¿¡æ¯: "å›¾ç‰‡å¤§å°è¶…è¿‡é™åˆ¶"

**è§£å†³æ­¥éª¤**:
1. å‹ç¼©å›¾ç‰‡è‡³2MBä»¥ä¸‹
2. ä½¿ç”¨å›¾ç‰‡å‹ç¼©å·¥å…·ï¼š
   ```bash
   # ä½¿ç”¨ImageMagickå‹ç¼©å›¾ç‰‡
   convert input.jpg -quality 80 -resize 1920x1080> output.jpg
   ```
3. è€ƒè™‘ä½¿ç”¨å›¾ç‰‡URLè€ŒéBase64ç¼–ç 

#### é”™è¯¯ä¿¡æ¯: "Base64ç¼–ç é”™è¯¯"

**è§£å†³æ­¥éª¤**:
1. ç¡®è®¤Base64å­—ç¬¦ä¸²ä¸åŒ…å«`data:image/`å‰ç¼€
2. éªŒè¯Base64ç¼–ç æ˜¯å¦æœ‰æ•ˆï¼š
   ```javascript
   // åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­æµ‹è¯•
   try {
     atob('your-base64-string');
     console.log('Base64ç¼–ç æœ‰æ•ˆ');
   } catch (e) {
     console.log('Base64ç¼–ç æ— æ•ˆ');
   }
   ```
3. é‡æ–°ç”ŸæˆBase64ç¼–ç 

### 4. @æåŠåŠŸèƒ½é—®é¢˜

#### é—®é¢˜: @æåŠç”¨æˆ·æ²¡æœ‰æ”¶åˆ°é€šçŸ¥

**å¯èƒ½åŸå› **:
- ç”¨æˆ·IDä¸æ­£ç¡®
- ç”¨æˆ·ä¸åœ¨ç¾¤èŠä¸­
- æ‰‹æœºå·æ ¼å¼é”™è¯¯

**è§£å†³æ­¥éª¤**:
1. ç¡®è®¤ç”¨æˆ·åœ¨ç›®æ ‡ç¾¤èŠä¸­
2. ä½¿ç”¨æ­£ç¡®çš„ç”¨æˆ·IDæ ¼å¼
3. éªŒè¯æ‰‹æœºå·æ ¼å¼ï¼ˆ11ä½æ•°å­—ï¼‰
4. æµ‹è¯•ä½¿ç”¨`@all`æåŠæ‰€æœ‰äºº

**æ­£ç¡®çš„@æåŠæ ¼å¼**:
```javascript
{
  "messageType": "text",
  "content": "è¯·æ³¨æ„è¿™æ¡æ¶ˆæ¯",
  "mentionedUsers": "user1,user2,user3",  // ç”¨æˆ·IDï¼Œé€—å·åˆ†éš”
  "mentionedMobiles": "13800138000,13900139000"  // æ‰‹æœºå·ï¼Œé€—å·åˆ†éš”
}
```

### 5. é¢‘ç‡é™åˆ¶é”™è¯¯

#### é”™è¯¯ä»£ç : 45009
**é”™è¯¯ä¿¡æ¯**: "æ¥å£è°ƒç”¨è¶…è¿‡é™åˆ¶"

**è§£å†³æ­¥éª¤**:
1. é™ä½æ¶ˆæ¯å‘é€é¢‘ç‡
2. å®ç°å‘é€é—´éš”æ§åˆ¶ï¼š
   ```javascript
   // åœ¨FunctionèŠ‚ç‚¹ä¸­æ·»åŠ å»¶è¿Ÿ
   await new Promise(resolve => setTimeout(resolve, 1000)); // ç­‰å¾…1ç§’
   ```
3. ä½¿ç”¨æ‰¹é‡å‘é€åŠŸèƒ½åˆå¹¶æ¶ˆæ¯
4. ç›‘æ§å‘é€é¢‘ç‡ï¼Œé¿å…çŸ­æ—¶é—´å†…å¤§é‡å‘é€

## ğŸ” è°ƒè¯•æŠ€å·§

### 1. å¯ç”¨è¯¦ç»†æ—¥å¿—

åœ¨èŠ‚ç‚¹é…ç½®ä¸­å¯ç”¨è°ƒè¯•æ¨¡å¼ï¼š
```javascript
// åœ¨å·¥ä½œæµè®¾ç½®ä¸­å¯ç”¨è¯¦ç»†æ—¥å¿—
{
  "settings": {
    "executionOrder": "v1",
    "saveManualExecutions": true,
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": "",
    "timezone": "Asia/Shanghai"
  }
}
```

### 2. æ£€æŸ¥è¾“å‡ºæ•°æ®

æŸ¥çœ‹èŠ‚ç‚¹çš„è¾“å‡ºæ•°æ®äº†è§£æ‰§è¡Œç»“æœï¼š
```json
{
  "success": false,
  "errorCode": 93000,
  "errorMessage": "Webhook URLæ— æ•ˆæˆ–å·²è¿‡æœŸ",
  "timestamp": 1642234567890,
  "messageType": "text",
  "input": {
    "messageType": "text",
    "content": "æµ‹è¯•æ¶ˆæ¯"
  }
}
```

### 3. ä½¿ç”¨æµ‹è¯•å·¥å…·

#### æµ‹è¯•Webhook URL
```bash
# ä½¿ç”¨curlæµ‹è¯•webhook
curl -X POST "YOUR_WEBHOOK_URL" \
  -H "Content-Type: application/json" \
  -d '{
    "msgtype": "text",
    "text": {
      "content": "æµ‹è¯•æ¶ˆæ¯"
    }
  }'
```

#### éªŒè¯Base64ç¼–ç 
```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­éªŒè¯
const base64String = 'your-base64-string';
try {
  const binaryString = atob(base64String);
  console.log('Base64æœ‰æ•ˆï¼Œé•¿åº¦:', binaryString.length);
} catch (error) {
  console.log('Base64æ— æ•ˆ:', error.message);
}
```

### 4. ç½‘ç»œè¯Šæ–­

#### æ£€æŸ¥DNSè§£æ
```bash
nslookup qyapi.weixin.qq.com
```

#### æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
```bash
ping qyapi.weixin.qq.com
```

#### æ£€æŸ¥ç«¯å£è®¿é—®
```bash
telnet qyapi.weixin.qq.com 443
```

## ğŸ› ï¸ æ€§èƒ½ä¼˜åŒ–

### 1. æ‰¹é‡å¤„ç†ä¼˜åŒ–

å¯¹äºå¤§é‡æ¶ˆæ¯ï¼Œä½¿ç”¨æ‰¹é‡å¤„ç†ï¼š
```javascript
// åœ¨FunctionèŠ‚ç‚¹ä¸­å®ç°æ‰¹é‡å¤„ç†
const batchSize = 10;
const batches = [];

for (let i = 0; i < items.length; i += batchSize) {
  batches.push(items.slice(i, i + batchSize));
}

return batches.map(batch => ({
  json: { messages: batch }
}));
```

### 2. é”™è¯¯é‡è¯•ç­–ç•¥

å®ç°æ™ºèƒ½é‡è¯•æœºåˆ¶ï¼š
```javascript
// åœ¨FunctionèŠ‚ç‚¹ä¸­å®ç°é‡è¯•é€»è¾‘
async function sendWithRetry(message, maxRetries = 3) {
  for (let i = 0; i < maxRetries; i++) {
    try {
      const result = await sendMessage(message);
      if (result.success) return result;
    } catch (error) {
      if (i === maxRetries - 1) throw error;
      await new Promise(resolve => setTimeout(resolve, 1000 * (i + 1)));
    }
  }
}
```

### 3. å†…å­˜ä½¿ç”¨ä¼˜åŒ–

å¤„ç†å¤§é‡æ•°æ®æ—¶æ³¨æ„å†…å­˜ä½¿ç”¨ï¼š
```javascript
// é¿å…åœ¨å†…å­˜ä¸­ä¿å­˜å¤§é‡æ•°æ®
const processInChunks = (data, chunkSize = 100) => {
  const chunks = [];
  for (let i = 0; i < data.length; i += chunkSize) {
    chunks.push(data.slice(i, i + chunkSize));
  }
  return chunks;
};
```

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### 1. è®¾ç½®ç›‘æ§å‘Šè­¦

åˆ›å»ºç›‘æ§å·¥ä½œæµæ£€æŸ¥æ¶ˆæ¯å‘é€çŠ¶æ€ï¼š
```json
{
  "name": "æ¶ˆæ¯å‘é€ç›‘æ§",
  "trigger": "schedule",
  "schedule": "*/5 * * * *",
  "nodes": [
    {
      "type": "httpRequest",
      "name": "æ£€æŸ¥APIçŠ¶æ€",
      "url": "https://qyapi.weixin.qq.com"
    },
    {
      "type": "if",
      "name": "åˆ¤æ–­çŠ¶æ€",
      "condition": "{{$json.status}} !== 200"
    },
    {
      "type": "weworkBot",
      "name": "å‘é€å‘Šè­¦",
      "messageType": "text",
      "content": "âš ï¸ ä¼ä¸šå¾®ä¿¡APIå¼‚å¸¸ï¼Œè¯·æ£€æŸ¥ï¼"
    }
  ]
}
```

### 2. æ—¥å¿—åˆ†æ

å®šæœŸåˆ†ææ‰§è¡Œæ—¥å¿—ï¼š
```bash
# åˆ†æé”™è¯¯æ¨¡å¼
grep "ERROR" /var/log/n8n/executions.log | \
  awk '{print $4}' | sort | uniq -c | sort -nr

# ç»Ÿè®¡æˆåŠŸç‡
grep "WeworkBot" /var/log/n8n/executions.log | \
  grep -c "success.*true" && \
  grep "WeworkBot" /var/log/n8n/executions.log | wc -l
```

### 3. æ€§èƒ½ç›‘æ§

ç›‘æ§å…³é”®æ€§èƒ½æŒ‡æ ‡ï¼š
- æ¶ˆæ¯å‘é€æˆåŠŸç‡
- å¹³å‡å“åº”æ—¶é—´
- é”™è¯¯é¢‘ç‡
- å†…å­˜ä½¿ç”¨æƒ…å†µ

## ğŸ†˜ è·å–å¸®åŠ©

å¦‚æœä»¥ä¸Šè§£å†³æ–¹æ¡ˆéƒ½æ— æ³•è§£å†³æ‚¨çš„é—®é¢˜ï¼Œè¯·ï¼š

1. **æ”¶é›†ä¿¡æ¯**:
   - é”™è¯¯ä¿¡æ¯çš„å®Œæ•´æˆªå›¾
   - èŠ‚ç‚¹é…ç½®çš„å¯¼å‡ºæ–‡ä»¶
   - æ‰§è¡Œæ—¥å¿—çš„ç›¸å…³éƒ¨åˆ†
   - n8nç‰ˆæœ¬å’Œç¯å¢ƒä¿¡æ¯

2. **æ£€æŸ¥æ–‡æ¡£**:
   - [å®Œæ•´æ–‡æ¡£](./README.md)
   - [å¿«é€Ÿå¼€å§‹æŒ‡å—](./QUICK_START.md)
   - [ä¼ä¸šå¾®ä¿¡å®˜æ–¹æ–‡æ¡£](https://developer.work.weixin.qq.com/document/path/91770)

3. **ç¤¾åŒºæ”¯æŒ**:
   - n8nç¤¾åŒºè®ºå›
   - GitHub Issues
   - æŠ€æœ¯æ”¯æŒé‚®ç®±

4. **æä¾›åé¦ˆ**:
   - æŠ¥å‘ŠBug
   - åŠŸèƒ½å»ºè®®
   - æ–‡æ¡£æ”¹è¿›å»ºè®®

## ğŸ“‹ æ£€æŸ¥æ¸…å•

åœ¨å¯»æ±‚å¸®åŠ©å‰ï¼Œè¯·ç¡®è®¤å·²å®Œæˆä»¥ä¸‹æ£€æŸ¥ï¼š

- [ ] Webhook URLæ ¼å¼æ­£ç¡®ä¸”æœ‰æ•ˆ
- [ ] ç¾¤æœºå™¨äººä»ç„¶å­˜åœ¨ä¸”å¯ç”¨
- [ ] ç½‘ç»œè¿æ¥æ­£å¸¸
- [ ] æ¶ˆæ¯å†…å®¹ç¬¦åˆæ ¼å¼è¦æ±‚
- [ ] å‚æ•°ç±»å‹å’Œå€¼æ­£ç¡®
- [ ] å›¾ç‰‡æ ¼å¼å’Œå¤§å°ç¬¦åˆé™åˆ¶
- [ ] @æåŠçš„ç”¨æˆ·åœ¨ç¾¤èŠä¸­
- [ ] å‘é€é¢‘ç‡åœ¨é™åˆ¶èŒƒå›´å†…
- [ ] å·²æŸ¥çœ‹æ‰§è¡Œæ—¥å¿—
- [ ] å·²å°è¯•åŸºæœ¬çš„æ•…éšœæ’é™¤æ­¥éª¤

---

**è®°ä½**: å¤§å¤šæ•°é—®é¢˜éƒ½å¯ä»¥é€šè¿‡ä»”ç»†æ£€æŸ¥é…ç½®å’ŒæŸ¥çœ‹é”™è¯¯ä¿¡æ¯æ¥è§£å†³ã€‚ä¿æŒè€å¿ƒï¼Œé€æ­¥æ’æŸ¥é—®é¢˜ï¼