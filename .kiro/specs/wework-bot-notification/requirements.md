# 企业微信群机器人通知节点需求文档

## 介绍

本功能旨在为n8n工作流平台创建一个专用的企业微信群机器人通知节点，允许用户通过webhook URL向企业微信群聊发送各种类型的消息通知。该节点将支持企业微信群机器人API的主要消息类型，包括文本、markdown、图片、图文等格式，为企业内部自动化通知提供便利。

## 需求

### 需求 1

**用户故事：** 作为n8n节点的配置者，我希望能够安全地管理企业微信群机器人的webhook URL，以便保护敏感的认证信息。

#### 验收标准

1. WHEN 用户首次配置节点 THEN 系统应该提供webhook URL的输入字段
2. WHEN webhook URL格式不正确 THEN 系统应该提供URL格式验证
3. WHEN 保存配置 THEN 系统应该安全存储webhook URL信息
4. WHEN 测试连接 THEN 系统应该提供连接测试功能验证URL有效性

### 需求 2

**用户故事：** 作为n8n工作流的开发者，我希望能够向企业微信群发送文本消息，以便在工作流执行过程中及时通知团队成员。

#### 验收标准

1. WHEN 用户配置了有效的企业微信群机器人webhook URL THEN 系统应该能够成功发送文本消息
2. WHEN 用户输入文本内容 THEN 系统应该支持纯文本和@提及特定成员的功能
3. WHEN 消息发送成功 THEN 系统应该返回成功状态和消息ID
4. WHEN 消息发送失败 THEN 系统应该返回详细的错误信息和错误代码
5. WHEN 文本内容超过4096字符 THEN 系统应该提示内容过长错误

### 需求 3

**用户故事：** 作为n8n工作流的开发者，我希望能够发送Markdown格式的消息，以便提供更丰富的格式化内容展示。

#### 验收标准

1. WHEN 用户选择Markdown消息类型 THEN 系统应该支持标准Markdown语法
2. WHEN Markdown内容包含链接、加粗、斜体等格式 THEN 系统应该正确渲染这些格式
3. WHEN Markdown内容超过4096字符 THEN 系统应该提示内容过长错误
4. IF Markdown语法有误 THEN 系统应该提供语法验证提示

### 需求 4

**用户故事：** 作为n8n工作流的开发者，我希望能够发送图片消息，以便在通知中包含截图、图表等可视化内容。

#### 验收标准

1. WHEN 用户提供图片的base64编码或图片URL THEN 系统应该能够发送图片消息
2. WHEN 图片大小超过2MB THEN 系统应该提示图片过大错误
3. WHEN 图片格式不支持 THEN 系统应该提示仅支持jpg、png格式
4. WHEN 图片发送成功 THEN 系统应该返回图片的media_id

### 需求 5

**用户故事：** 作为n8n工作流的开发者，我希望能够发送图文消息，以便提供包含标题、描述和链接的丰富内容卡片。

#### 验收标准

1. WHEN 用户配置图文消息 THEN 系统应该支持标题、描述、图片URL和跳转链接
2. WHEN 标题超过128字符 THEN 系统应该提示标题过长错误
3. WHEN 描述超过512字符 THEN 系统应该提示描述过长错误
4. WHEN 跳转链接无效 THEN 系统应该提供URL格式验证

### 需求 6

**用户故事：** 作为n8n工作流的开发者，我希望能够发送文件消息，以便在群聊中分享文档、报告等文件。

#### 验收标准

1. WHEN 用户提供文件的media_id THEN 系统应该能够发送文件消息
2. WHEN 文件大小超过20MB THEN 系统应该提示文件过大错误
3. WHEN 文件类型不支持 THEN 系统应该提示支持的文件类型列表
4. WHEN 文件发送成功 THEN 系统应该返回文件消息的发送状态

### 需求 7

**用户故事：** 作为n8n工作流的开发者，我希望节点能够处理各种错误情况，以便在出现问题时能够及时发现和处理。

#### 验收标准

1. WHEN 网络连接失败 THEN 系统应该返回网络错误信息并支持重试
2. WHEN webhook URL无效或过期 THEN 系统应该返回认证错误信息
3. WHEN 企业微信API返回错误 THEN 系统应该解析并返回具体的错误原因
4. WHEN 消息格式不符合要求 THEN 系统应该返回格式验证错误信息
5. WHEN 发送频率超限 THEN 系统应该返回频率限制错误并建议等待时间

### 需求 8

**用户故事：** 作为n8n工作流的开发者，我希望节点能够提供详细的执行日志，以便调试和监控消息发送状态。

#### 验收标准

1. WHEN 消息发送开始 THEN 系统应该记录发送请求的详细信息
2. WHEN 消息发送完成 THEN 系统应该记录响应状态和耗时信息
3. WHEN 发生错误 THEN 系统应该记录详细的错误堆栈和上下文信息
4. WHEN 启用调试模式 THEN 系统应该输出完整的请求和响应数据